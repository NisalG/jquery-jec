(function($){$.jecCore={defaults:{position:0,classes:'',styles:{},pluginClass:'jecEditableOption',useExistingOptions:false,ignoredKeys:[],acceptedRanges:[{min:32,max:126},{min:191,max:382}]},options:{},values:{},ieHacks:function(){if($.browser.msie&&Array.prototype.indexOf===null){Array.prototype.indexOf=function(object){for(var i=0;i<this.length;i+=1){if(this[i]===object){return i;}}return-1;};}},clone:function(obj){if(obj===null||typeof(obj)!=='object'){return obj;}var temp=new obj.constructor(),key;for(key in obj){if(key!==undefined){temp[key]=$.jecCore.clone(obj[key]);}}return temp;},getKeyCode:function(event){if(typeof(event.charCode)!=='undefined'&&event.charCode!==0){return event.charCode;}else{return event.keyCode;}},specialKeys:[46,37,38,39,40],lastKeyCode:null,setEditableOption:function(elem){var options=$.jecCore.options['id'+elem.attr('jec')];elem.children('option.'+options.pluginClass).val(elem.children('option:selected').text());},generateId:function(){while(true){var random=Math.floor(Math.random()*100000);if(typeof($.jecCore.options['id'+random])==='undefined'){return random;}}},jecKeyDown:function(event){var keyCode,option,value,options;options=$.jecCore.options['id'+$(this).attr('jec')];keyCode=$.jecCore.getKeyCode(event);$.jecCore.lastKeyCode=keyCode;switch(keyCode){case 8:case 46:option=$(this).children('option.'+options.pluginClass);if(option.val().length>=1){value=option.val().substring(0,option.val().length-1);option.val(value).text(value).attr('selected','selected');}return(keyCode!==8);default:break;}},jecKeyPress:function(event){var keyCode,keyValue,i,option,value,validKey,options;options=$.jecCore.options['id'+$(this).attr('jec')];keyCode=$.jecCore.getKeyCode(event);if(keyCode!==9){for(i=0;i<$.jecCore.specialKeys.length;i+=1){if(keyCode===$.jecCore.specialKeys[i]&&keyCode===$.jecCore.lastKeyCode){return;}}if(options.ignoredKeys.indexOf(keyCode)===-1){$(this).children(':selected').removeAttr('selected');keyValue='';for(validKey in options.acceptedRanges){if((typeof(options.acceptedRanges[validKey].exact)!=='undefined'&&options.acceptedRanges[validKey].exact===keyCode)||(typeof(options.acceptedRanges[validKey].min)!=='undefined'&&typeof(options.acceptedRanges[validKey].max)!=='undefined'&&keyCode>=options.acceptedRanges[validKey].min&&keyCode<=options.acceptedRanges[validKey].max)){keyValue=String.fromCharCode(keyCode);}}option=$(this).children('option.'+options.pluginClass);value=option.val()+keyValue;option.val(value).text(value).attr('selected','selected');}return false;}},jecChange:function(){$.jecCore.setEditableOption($(this));},setup:function(elem){var options,editableOption,i;options=$.jecCore.options['id'+elem.attr('jec')];if(typeof(options)!=='undefined'){if(elem.children(options.pluginClass).length===0){editableOption=$(document.createElement('option'));editableOption.addClass(options.pluginClass);if(typeof(options.classes)==='string'){editableOption.addClass(options.classes);}else if(typeof(options.classes)==='object'){for(i=0;i<options.classes.length;i+=1){editableOption.addClass(options.classes[i]);}}if(typeof(options.styles)==='object'){for(i=0;i<options.styles.length;i+=1){editableOption.append(options.styles[i]);}}if(elem.children().eq(options.position).length!==0){elem.children().eq(options.position).before(editableOption);}else{elem.append(editableOption);}}elem.bind('keydown',$.jecCore.jecKeyDown);elem.bind('keypress',$.jecCore.jecKeyPress);if(options.useExistingOptions){$.jecCore.setEditableOption(elem);elem.bind('change',$.jecCore.jecChange);}}},init:function(settings){$.jecCore.ieHacks();return $(this).filter('select:not([jec])').each(function(){var random;random=$.jecCore.generateId();$.jecCore.options['id'+random]=$.extend($.jecCore.clone($.jecCore.defaults),settings);$(this).attr('jec',random);$.jecCore.setup($(this));});},destroy:function(){return $(this).filter('select[jec]').each(function(){$(this).jecOff();$(this).removeAttr('jec');});},enable:function(){return $(this).filter('select[jec]').each(function(){$.jecCore.setup($(this));var value=$.jecCore.values['id'+$(this).attr('jec')];if(value!==undefined){$(this).jecValue(value);}});},disable:function(){return $(this).filter('select[jec]').each(function(){var id,options;id='id'+$(this).attr('jec');options=$.jecCore.options[id];$.jecCore.values[id]=$(this).children('option.'+options.pluginClass).val();$(this).children('option.'+options.pluginClass).remove();$(this).unbind('keydown',$.jecCore.jecKeyDown);$(this).unbind('keypress',$.jecCore.jecKeyPress);if(options!==null&&options.useExistingOptions){$(this).unbind('change',$.jecCore.jecChange);}});},value:function(value,setFocus){var options=$.jecCore.options['id'+$(this).attr('jec')];if(typeof(value)==='undefined'||value===null){return $(this).children('option.'+options.pluginClass).val();}else if(typeof(value)==='string'||typeof(value)==='number'){return $(this).filter('select').each(function(){var option=$(this).children('option.'+options.pluginClass);option.val(value).text(value);if(typeof(setFocus)!=='boolean'||setFocus){option.attr('selected','selected');}});}}};$.fn.extend({jec:$.jecCore.init,jecOn:$.jecCore.enable,jecOff:$.jecCore.disable,jecKill:$.jecCore.destroy,jecValue:$.jecCore.value,editableCombobox:$.jecCore.init});})(jQuery);